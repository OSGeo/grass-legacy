                   INSTALL GRASS 5.0 source code

($Id: INSTALL,v 1.7 2000-11-13 09:55:49 markus Exp $)

To compile GRASS, please read the file REQUIREMENTS. Note: If your
system does not fullfil all requirements, some modules won't be
compiled.

The intent of the new install method is to have the following sequence
of commands work to install GRASS on any platform.  If for some reason
you wish to use the old "GISGEN" method, refer to the file called
INSTALL.gmake for instruction.

	./configure
	make install
        gmakelinks5

The `configure' command (possibly with options; see below) should
identify all relevant system dependencies and create several files
(see below) containing dependency information.  The `make' command
at time only generates a few internal files.
The `make install' command should compile and install GRASS
in the main filesystem. The `gmakelinks5' generates internal links
finally for every module.

NOTE:  You may need to be 'root' to do this!

If you want to change this, use a sequence like this:

	./configure --prefix=/opt/grass5.0 --with-bindir=/usr/bin/
	make install
        gmakelinks5

This will install the GRASS modules, help, and other need libraries
etc. in the directory /opt/grass5.0 and the startup file 'grass5.0'
in the directory /usr/bin.  See the configure options below for more
information.

At this point that system should work as above, with a few known
exceptions (see below).  If you identify problems (e.g., system
dependencies not already accounted for by `configure') please pass
along the relevant information (e.g., operating system, dependency
information, and ideally a fix) so the configuration system can be
fixed.


Old install method

Note that the old install method based on running GISGEN directly
should still work (though be sure to check the files created by
`configure').  In this case, something along the lines of the
following should work.

	./configure
	setenv GRASSSRC `pwd`/src
	setenv GMAKE `pwd`/src/CMD/gmake5.0
	sh src/CMD/generic/GISGEN.sh
	sh src/CMD/generic/MAKELINKS.sh

Note that if you are using something akin to the Bourne shell you must
set the environment variables differently (e.g., VAR=value; export
VAR).  If you wish to use the old "head" files, you will need to
follow the old INSTALL directions after running `configure'.

Finally, note that because the source files now depend on
src/include/config.h and src/scripts/shells/create_fifos.sh, it is
imperative to run the `configure' script regardless of the ultimate
installation method.

A general "gmake5" script is created in /usr/local/bin (standard)
which allows to compile modules separately. It is required to run
the "configure" process in advance and to compile the required
library files.

Note for Alpha64 users: Please read the ALPHA64/README.alpha64
                        and apply the 64bit patches.

CONFIGURE OPTIONS

The `configure' script takes a number of options.  Because it is
derived from the GNU autoconf system, `configure' accepts all the
normal options.  The following lists a few that are relevant to GRASS.

	--help				lists all available options
	--prefix=DIR			install GRASS (except user
					executable program) in DIR
	--with-bindir=DIR		install user executable
					program in DIR 
	--with-includes=DIRS		add DIRS to the compiler flags (-I) 
	--with-libs=DIRS		add DIRS to the compiler flags (-L)
	--with-tiff-includes=DIRS	add DIRS to the compiler flags
					(-I) for locating TIFF files
	--with-tiff-libs=DIRS		add DIRS to the compiler flags
					(-L) for locating TIFF libraries
        --without-PACKAGE               do not use PACKAGE (same as
                                        --with-PACKAGE=no)
	--with-SYSV			define the SYSV macro
	--with-USE_TERMIO		define the USE_TERMIO macro

Note that DIRS can be a space separated list of directories.  Note
also that the last two options are needed only on a few systems to
account for system dependencies that are not yet included within the
`configure' script (see below).  They will be removed in future
versions.

To disable the support of a specific package you can use the
        --without-PACKAGE
option.
Example: To disable PostgreSQL support you will specify
        configure --without-postgresql


FILES TO CHECK

The `configure' script creates the following files to contain system
dependencies: 

	Makefile
	src/CMD/head/head.$ARCH
	src/include/config.h
	src/scripts/shells/create_fifos.sh

$ARCH is a variable containing the host system (example:
head.i686-pc-linux-gnu).
After running `configure' it is wise to check these files to verify
that they contain the correct information.  In particular, several
known exceptions (see below) might need fixing in src/CMD/head/head.$ARCH.


KNOWN EXCEPTIONS

Several known system dependencies are currently not handled
automatically by the `configure' script.  Eventually these will be
fixed, especially if people with these systems can help (see below).

Scattered throughout the source code are dependencies on the C
preprocessor macro `SYSV'.  Only `hpux10' machines need to define this
macro in src/CMD/head/head.$ARCH:

	XLDFLAGS = -DSYSV

This is accomplished by the --with-SYSV option to `configure'.


CLEANING UP

There are five options for cleaning the GRASS source code. The first four
options are based on the GNU guidlines at:

http://www.gnu.org/manual/make-3.77/html_node/make_118.html

A fifth option is specific to the GRASS development project and does not
conform to the GNU standard. Each option performs the following operations:

make mostlyclean  	- delete all object files, the next step file, and the
   	    	    	  binary install script if it exists, keep the compiled
   	    	    	  GRASS libraries - good for saving disk space
make clean        	- delete object files, next step file, libraries, and
 		      	  generated directories like etc/ and dev/ - good for
                     	  recompiling on the same system (keep configure files)
make distclean    	- delete object files, next step file, libraries,
   	    	    	  generated directories, head file, configure files,
   	    	    	  and Makefile - good for starting the whole
   	    	    	  installation from scratch
make maintainer-clean 	- delete object files, next step file, libraries,
   	    	    	  generated directories, and generated lex/flex and
   	    	     	  yacc/bison files - good for recompiling on the same
   	    	    	  system and also generating the lex/flex and
   	    	    	  yacc/bison files again
make savebinclean    	- delete object files, next step file, the binary
   	    	    	  install script if it exists, libraries, head file,
   	    	    	  configure files, and Makefile - good for deleting
   	    	    	  everything but the binary files


COMPILE SINGLE MODULE(S)

To compile a single module, you need to run the "configure" script
first. Then the GRASS libraries need to be compiled (if not already done).
Change to src/libes/ and run

   gmake5

Then go into your module's directory and compile it with:

   gmake5

Finally the module has to be linked to the GRASS front.end by:
  
   gmakelinks5

Then you should be able to use the module.


THINGS TO DO

A major task remaining is to replace the GISGEN system with a
proper set of Makefiles, all of which include a common one containing
the system dependencies.

Finally, to ensure that this system continues to work, GRASS
programmers need to be encouraged to include

	#include "config.h"

in their files and to make use of the various system dependencies
contained therein.  As one example of this, see
src/paint/Interface/driverlib/io.c.  Programmers also need to be
encouraged to refrain from declaring system functions within the
software; include the proper header files (conditionally dependent on
config.h macros if necessary) instead.
